# LearnFlask Advert API

Простой RESTful API, созданный с использованием Flask, для управления аутентификацией пользователей и размещения объявлений.

## Технологический стек

- **Python**: Основной язык программирования.
- **Flask**: Микрофреймворк для создания веб-приложения и API.
- **Flask-SQLAlchemy**: ORM для взаимодействия с базой данных.
- **Flask-Migrate**: Управление миграциями схемы базы данных (с использованием Alembic).
- **Flask-JWT-Extended**: Реализация аутентификации на основе JSON Web Token (JWT).
- **PostgreSQL**: Реляционная база данных для хранения данных.
- **psycopg2-binary**: Адаптер PostgreSQL для Python.
- **python-dotenv**: Загрузка переменных окружения из файла`.env`.
- **Werkzeug**: Библиотека WSGI (включает хеширование паролей).
- **pytest**: Фреймворк для написания и запуска тестов.

## Предварительные требования

Перед началом работы убедитесь, что у вас установлены:

- Python (рекомендуется версия 3.8+)
- pip (обычно идет вместе с Python)
- PostgreSQL (сервер базы данных)
- Git (для клонирования репозитория)

## Установка и настройка

1. **Клонируйте репозиторий:**

   ```bash
   git clone <URL_вашего_репозитория>
   cd LearnFlask
   ```
2. **Создайте и активируйте виртуальное окружение:**

   - **Linux / macOS:**

     ```bash
     python3 -m venv venv
     source venv/bin/activate
     ```
   - **Windows:**

     ```bash
     python -m venv venv
     .\venv\Scripts\activate
     ```
3. **Установите зависимости:**

   ```bash
   pip install -r requirements.txt
   ```
4. **Настройте базу данных PostgreSQL:**

   - Убедитесь, что сервер PostgreSQL запущен.
   - Создайте две базы данных: одну для разработки/работы и одну для тестов. Вы можете использовать `psql` или другой инструмент администрирования БД.

     ```sql
     -- Пример команд в psql:
     CREATE DATABASE your_db_name;
     CREATE DATABASE your_test_db_name;
     ```
   - Убедитесь, что у вас есть пользователь с правами доступа к этим базам данных.
5. **Настройте переменные окружения:**

   - Создайте файл с именем `.env` в корневой директории проекта (на одном уровне с `run.py`).
   - Скопируйте и измените следующие переменные, подставив ваши значения:

     ```dotenv
     # Ключи для безопасности Flask и JWT (сгенерируйте случайные строки)
     SECRET_KEY='ваша_очень_секретная_строка_для_flask'
     JWT_SECRET_KEY='ваша_другая_очень_секретная_строка_для_jwt'

     # Настройки подключения к основной БД
     DB_USER='ваш_пользователь_postgres'
     DB_PASSWORD='ваш_пароль_postgres'
     DB_HOST='localhost'  # или адрес вашего сервера БД
     DB_PORT='5432'       # стандартный порт PostgreSQL
     DB_NAME='your_db_name' # Имя основной базы данных

     # Имя тестовой БД (используется в TestConfig)
     TEST_DB_NAME='your_test_db_name'

     # (Опционально) Для работы команд flask (если не используется run.py)
     # FLASK_APP=run:app
     ```
   - **Важно:** Добавьте `.env` в ваш файл `.gitignore`, чтобы случайно не загрузить секретные данные в репозиторий.
6. **Примените миграции базы данных:**

   - Убедитесь, что ваше виртуальное окружение активировано и переменные окружения из `.env` доступны.
   - Выполните команду для создания таблиц в _основной_ базе данных:

     ```bash
     flask db upgrade
     ```

     _(Примечание: Если команда `flask` не найдена, возможно, потребуется установить переменную окружения `FLASK_APP=run:app` или убедиться, что пакет установлен правильно)._

## Запуск приложения

Для запуска сервера разработки Flask выполните:

```bash
python run.py
```

Приложение будет доступно по адресу [http://127.0.0.1:5000](http://127.0.0.1:5000) (или другому порту, если он занят). Сервер автоматически перезагружается при изменениях в коде благодаря debug=True.

Warning: Не используйте встроенный сервер Flask (debug=True) в реальном (production) окружении!

## **Запуск тестов**

**Для запуска автоматических тестов выполните:**

```
pytest
```

**Тесты будут использовать конфигурацию** **TestConfig** **и подключаться к вашей** **тестовой** **базе данных (\*\***TEST_DB_NAME\*\* **из** **.env\*\***). Тесты автоматически создадут и удалят схему БД для тестовой сессии и очистят данные между тестами.\*\*

## **API Эндпоинты** (\*без версионности)


| **Метод** | **Путь**           | **Описание**                                                     | **Аутентификация** |
| ---------------- | ------------------------ | -------------------------------------------------------------------------- | ---------------------------------- |
| **POST**       | **/api/auth/register** | **Регистрация нового пользователя**         | **Нет**                       |
| **POST**       | **/api/auth/login**    | **Вход пользователя, получение токена**   | **Нет**                       |
| **POST**       | **/api/adverts/**      | **Создание нового объявления**                   | **Да (JWT)**                   |
| **GET**        | **/api/adverts/**      | **Получение списка всех объявлений**        | **Нет**                       |
| **PUT**        | **/api/adverts/**      | **Обновление существующего объявления** | **Да (JWT)**                   |
| **DELETE**     | **/api/adverts/**      | **Удаление существующего объявления**     | **Да (JWT)**                   |

Ознакомиться с документацией и протестировать API можно с помощью [Postman](https://bold-astronaut-977939-2110.postman.co/workspace/%D1%82%D0%B5%D1%81%D1%82%D0%BE%D0%B2%D0%B0%D1%8F-%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D0%B0-Workspace~1c03f5ee-9ced-48e9-8fd8-011c1a93ffca/collection/42519970-c5c31904-1086-4148-861e-328e34b4f786?action=share&creator=42519970)
